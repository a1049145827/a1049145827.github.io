<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="iOS," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="如果想用 Swift 练习一下排序算法，就会碰到这么一个需求：创建几个完全一样的数组，来对比不同排序算法间的性能差异。 在 OC 时代，我们可以使用工具类创建一个可变数组，向数组中填充我们生成的随机数，然后对这个数组做可变拷贝，再定义几个新的变量进行赋值，最终每个算法使用新的数组进行排序，这样能保证每个排序算法分配到的随机数组是完全一致的，并且排序的时候互不干扰。 123// 为数组创建可变拷贝(">
<meta name="keywords" content="iOS">
<meta property="og:type" content="article">
<meta property="og:title" content="Swift4 中的 Struct 写时复制">
<meta property="og:url" content="http://yoursite.com/2018/10/16/Swift4-中的-Struct写时复制/index.html">
<meta property="og:site_name" content="Bruce&#39;s Blog">
<meta property="og:description" content="如果想用 Swift 练习一下排序算法，就会碰到这么一个需求：创建几个完全一样的数组，来对比不同排序算法间的性能差异。 在 OC 时代，我们可以使用工具类创建一个可变数组，向数组中填充我们生成的随机数，然后对这个数组做可变拷贝，再定义几个新的变量进行赋值，最终每个算法使用新的数组进行排序，这样能保证每个排序算法分配到的随机数组是完全一致的，并且排序的时候互不干扰。 123// 为数组创建可变拷贝(">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-10-16T07:50:49.045Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Swift4 中的 Struct 写时复制">
<meta name="twitter:description" content="如果想用 Swift 练习一下排序算法，就会碰到这么一个需求：创建几个完全一样的数组，来对比不同排序算法间的性能差异。 在 OC 时代，我们可以使用工具类创建一个可变数组，向数组中填充我们生成的随机数，然后对这个数组做可变拷贝，再定义几个新的变量进行赋值，最终每个算法使用新的数组进行排序，这样能保证每个排序算法分配到的随机数组是完全一致的，并且排序的时候互不干扰。 123// 为数组创建可变拷贝(">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/10/16/Swift4-中的-Struct写时复制/"/>





  <title>Swift4 中的 Struct 写时复制 | Bruce's Blog</title>
  














</head>


<script type="text/javascript"
color="0,0,255" opacity='0.7' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>


<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <a href="https://github.com/a1049145827"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>
    
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Bruce's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Hi~</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/16/Swift4-中的-Struct写时复制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Coder bruce">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bruce's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Swift4 中的 Struct 写时复制</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-16T11:12:54+08:00">
                2018-10-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS开发/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>如果想用 Swift 练习一下排序算法，就会碰到这么一个需求：创建几个完全一样的数组，来对比不同排序算法间的性能差异。</p>
<p>在 OC 时代，我们可以使用工具类创建一个可变数组，向数组中填充我们生成的随机数，然后对这个数组做可变拷贝，再定义几个新的变量进行赋值，最终每个算法使用新的数组进行排序，这样能保证每个排序算法分配到的随机数组是完全一致的，并且排序的时候互不干扰。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为数组创建可变拷贝(深拷贝)</span></span><br><span class="line"><span class="built_in">NSMutableArray</span> *arr = [<span class="built_in">NSMutableArray</span> arrayWithObjects:@<span class="number">10</span>, @<span class="number">8</span>, @<span class="number">55</span>, <span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">NSMutableArray</span> *array1 = [arr mutableCopy];</span><br></pre></td></tr></table></figure>
<p>但是，在 Swift4.2 中，我们发现 Array 这个结构体并没有任何 copy 相关的方法，那我们如何做到生成多个完全一致却又互不干扰的随机数组呢？</p>
<p>查了资料发现，Swift 中 Struct 有“写时复制（Copy-On-Write）”的特性。</p>
<h3 id="什么是COW（Copy-On-Write）"><a href="#什么是COW（Copy-On-Write）" class="headerlink" title="什么是COW（Copy-On-Write）"></a>什么是COW（Copy-On-Write）</h3><p>我们都知道 Swift 有值类型和引用类型，而值类型在被赋值或被传递给函数时是会被拷贝的。在Swift中，所有的基本类型，包括整数、浮点数、字符串、数组和字典等都是值类型，并且都以结构体的形式实现。那么，我们在写代码时，这些值类型每次赋值传递都是会重新在内存里拷贝一份吗？</p>
<p>答案是否定的，想象一下，假如有个包含上千个元素的数组，然后你把它 copy 一份给另一个变量，那么 Swift 就要拷贝所有的元素，即使这两个变量的数组内容完全一样，这对它性能来说是多么糟糕。</p>
<p>在 <a href="https://developer.apple.com/library/content/documentation/Swift/Conceptual/Swift_Programming_Language/ClassesAndStructures.html#//apple_ref/doc/uid/TP40014097-CH13-ID82" target="_blank" rel="noopener">The Swift Programming Language (Swift 4.1) Classes and Structures</a> 章节中有如下一段话，也明确地提到了Swift对其实现做了优化，可避免不必要的复制：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The description above refers to the “copying” of strings, arrays, and dictionaries. The behavior you see in your code will always be as if a copy took place. However, Swift only performs an actual copy behind the scenes when it is absolutely necessary to do so. Swift manages all value copying to ensure optimal performance, and you should not avoid assignment to try to preempt this optimization.</span><br></pre></td></tr></table></figure>
<p>而这个优化方式就是 Copy-On-Write（写时复制），即只有当这个值需要改变时才进行复制行为。</p>
<p><strong>例子：</strong><br>首先，让我们看下面的例子我们更容易理解，我们创建了数组 array1，然后将 array1 赋值给 array2，再给 array2 数组添加多一个元素，我们通过查看其地址变化来确定是否进行了拷贝行为。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> array1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="keyword">var</span> array2 = array1</span><br><span class="line"><span class="comment">// 断点1</span></span><br><span class="line">array2.append(<span class="number">2</span>) </span><br><span class="line"><span class="comment">// 断点2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"hello world"</span>)</span><br></pre></td></tr></table></figure>
<p>断点1位置，使用 lldb 命令 <code>fr v -R [object]</code> 来查看对象内存结构。打印出 array1，array2 内存结构如下，我们可以看到 array1 和 array2 内存地址都是 0x0000000101a1a590，说明 array1 和 array2 此时是共享同一个实例</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">(lldb) fr v -<span class="type">R</span> array1</span><br><span class="line">(<span class="type">Swift</span>.<span class="type">Array</span>&lt;<span class="type">Swift</span>.<span class="type">Int</span>&gt;) array1 = &#123;</span><br><span class="line">  _buffer = &#123;</span><br><span class="line">    _storage = &#123;</span><br><span class="line">      rawValue = <span class="number">0x0000000101a1a590</span> &#123;</span><br><span class="line">        <span class="type">Swift</span>._ContiguousArrayStorageBase = &#123;</span><br><span class="line">          <span class="type">Swift</span>._SwiftNativeNSArrayWithContiguousStorage = &#123;</span><br><span class="line">            <span class="type">Swift</span>._SwiftNativeNSArray = &#123;&#125;</span><br><span class="line">          &#125;</span><br><span class="line">          countAndCapacity = &#123;</span><br><span class="line">            _storage = &#123;</span><br><span class="line">              <span class="built_in">count</span> = &#123;</span><br><span class="line">                _value = <span class="number">4</span></span><br><span class="line">              &#125;</span><br><span class="line">              _capacityAndFlags = &#123;</span><br><span class="line">                _value = <span class="number">8</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">(lldb) fr v -<span class="type">R</span> array2</span><br><span class="line">(<span class="type">Swift</span>.<span class="type">Array</span>&lt;<span class="type">Swift</span>.<span class="type">Int</span>&gt;) array2 = &#123;</span><br><span class="line">  _buffer = &#123;</span><br><span class="line">    _storage = &#123;</span><br><span class="line">      rawValue = <span class="number">0x0000000101a1a590</span> &#123;</span><br><span class="line">        <span class="type">Swift</span>._ContiguousArrayStorageBase = &#123;</span><br><span class="line">          <span class="type">Swift</span>._SwiftNativeNSArrayWithContiguousStorage = &#123;</span><br><span class="line">            <span class="type">Swift</span>._SwiftNativeNSArray = &#123;&#125;</span><br><span class="line">          &#125;</span><br><span class="line">          countAndCapacity = &#123;</span><br><span class="line">            _storage = &#123;</span><br><span class="line">              <span class="built_in">count</span> = &#123;</span><br><span class="line">                _value = <span class="number">4</span></span><br><span class="line">              &#125;</span><br><span class="line">              _capacityAndFlags = &#123;</span><br><span class="line">                _value = <span class="number">8</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>断点2位置，此时 array2 添加了新元素，打印 array2，内存结构如下，我们可以看到 array2 内存地址已经变成了0x0000000101a1a5d0，说明此时它们不再共享同一个实例，array2 对应的值进行了拷贝行为</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">(lldb) fr v -<span class="type">R</span> array2</span><br><span class="line">(<span class="type">Swift</span>.<span class="type">Array</span>&lt;<span class="type">Swift</span>.<span class="type">Int</span>&gt;) array2 = &#123;</span><br><span class="line">  _buffer = &#123;</span><br><span class="line">    _storage = &#123;</span><br><span class="line">      rawValue = <span class="number">0x0000000101a1a5d0</span> &#123;</span><br><span class="line">        <span class="type">Swift</span>._ContiguousArrayStorageBase = &#123;</span><br><span class="line">          <span class="type">Swift</span>._SwiftNativeNSArrayWithContiguousStorage = &#123;</span><br><span class="line">            <span class="type">Swift</span>._SwiftNativeNSArray = &#123;&#125;</span><br><span class="line">          &#125;</span><br><span class="line">          countAndCapacity = &#123;</span><br><span class="line">            _storage = &#123;</span><br><span class="line">              <span class="built_in">count</span> = &#123;</span><br><span class="line">                _value = <span class="number">5</span></span><br><span class="line">              &#125;</span><br><span class="line">              _capacityAndFlags = &#123;</span><br><span class="line">                _value = <span class="number">16</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由此可见，array2 未做修改时，array1 和 array2 是共享同一个实例。</p>
<h4 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h4><p>在结构体内部存储了一个指向实际数据的引用 reference，在不进行修改操作的普通传递过程中，都是将内部的reference 的应用计数 +1，在进行修改时，对内部的 reference 做一次 copy 操作，再在这个复制出来的数据进行真正的修改，防止和之前的 reference 产生意外的数据共享。</p>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>至此，我们已经能够轻松的解决刚开始的时候提出的问题：Swift 中 Array 是结构体，那么我们可以利用”写时复制“的特性，<strong>直接按照一定规则生成一个数组，然后定义新的变量，并用初始数组赋值，每个排序算法中使用一个数组变量，示例代码如下：</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Swift 中 Struct 具有“写时复制”的特性</span></span><br><span class="line"><span class="keyword">let</span> arr = <span class="type">SortHelper</span>.generateRandomArray(<span class="built_in">count</span>: <span class="number">100000</span>, maxValue: <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr1 = arr</span><br><span class="line"><span class="keyword">var</span> arr2 = arr</span><br><span class="line"><span class="keyword">var</span> arr3 = arr</span><br><span class="line"></span><br><span class="line"><span class="type">SortHelper</span>.testSort(sortName: <span class="string">"快速排序"</span>) &#123;</span><br><span class="line">    arr1.<span class="built_in">quickSort</span>()</span><br><span class="line">    <span class="built_in">assert</span>(arr1.isSorted)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">SortHelper</span>.testSort(sortName: <span class="string">"双路快排"</span>) &#123;</span><br><span class="line">    arr2.quickSort2Way()</span><br><span class="line">    <span class="built_in">assert</span>(arr2.isSorted)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">SortHelper</span>.testSort(sortName: <span class="string">"三路快排"</span>) &#123;</span><br><span class="line">    arr3.quickSort3Way()</span><br><span class="line">    <span class="built_in">assert</span>(arr3.isSorted)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>得到元素一致且互不干扰的数组之后，就可以安心的练习排序算法啦 :-D。</p>

      
    </div>
    
    
    
    <div>
    
    <div>
    
      <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
    
    </div>

    <div>
      
        
      
    </div>
    
    

    

    
    
    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/iOS/" rel="tag"><i class="fa fa-tag"></i> iOS</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/10/15/Swift-快速排序、双路快排和三路快排/" rel="next" title="Swift-快速排序、双路快排和三路快排">
                <i class="fa fa-chevron-left"></i> Swift-快速排序、双路快排和三路快排
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/10/17/探究-ReactiveObjC（RAC）-中-rac-signalForSelector-的实现/" rel="prev" title="探究 ReactiveObjC（RAC） 中 -rac_signalForSelector: 的实现">
                探究 ReactiveObjC（RAC） 中 -rac_signalForSelector: 的实现 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zMjU3Ni85MTM4"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="Coder bruce" />
          <p class="site-author-name" itemprop="name">Coder bruce</p>
           
              <p class="site-description motion-element" itemprop="description">hello world</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">69</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/a1049145827" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/u/ff82b16c5264" target="_blank" title="简书">
                  
                    <i class="fa fa-fw fa-heartbeat"></i>
                  
                    
                      简书
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是COW（Copy-On-Write）"><span class="nav-number">1.</span> <span class="nav-text">什么是COW（Copy-On-Write）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#具体实现"><span class="nav-number">1.1.</span> <span class="nav-text">具体实现</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#结论"><span class="nav-number">2.</span> <span class="nav-text">结论</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Coder bruce</span>
</div>



<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_pv">
  本站访客数:<span id="busuanzi_value_site_pv"></span>次
</span>
</div>







<div class="theme-info">
  <!-- <div class="powered-by"></div> -->
  <span class="post-count">博客全站共62.7k字</span>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>




  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  






  





  

  

  

  

  

  

</body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>